# This is an Nginx vhost config, to be included in a larger nginx
# setup.

upstream bootstrapcdn {
  server http://127.0.0.1:3331 max_fails=3 fail_timeout=10s;
  server http://127.0.0.1:3332 max_fails=3 fail_timeout=10s;
  server http://127.0.0.1:3333 max_fails=3 fail_timeout=10s;
  server http://dev.bootstrapcdn.com backup;
}

server {
    listen 80;
    server_name www.bootstrapcdn.com;

    # Should be more then large enough, revisit if getting 413 errors.
    client_max_body_size 4m;

    root /home/jmervine/bootstrap-cdn/public;

    include /home/jmervine/bootstrap-cdn/mime.types;

    expires 30d;

    add_header X-Powered-By "MaxCDN";
    add_header X-Hello-Human "You must be bored. You should work for us. Email jdorfman+theheader@maxcdn.com or @jdorfman on the twitter.";

    # Quick fix because root isn't working as expected, revisit
    # because this is a really ugly way of doing it.
    location /bootswatch/ {
        root /home/jmervine/bootstrap-cdn/public;
    }
    location /bootstrap/ {
        root /home/jmervine/bootstrap-cdn/public;
    }
    location /twitter-bootstrap/ {
        root /home/jmervine/bootstrap-cdn/public;
    }
    location /font-awesome/ {
        root /home/jmervine/bootstrap-cdn/public;
    }

    location / {
        proxy_pass http://bootstrapcdn;
        proxy_set_header Host      $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

server {
    server_name bootstrapcdn.com;
    return 301 http://www.bootstrapcdn.com$request_uri;
}

# vim: ft=nginx:
