extends layout

block head
    link(rel='stylesheet', href='/stylesheets/theme.bootstrap.min.css')

block content
    .container
        .row
            .col-sm-12
                h1 Popular Files Overview
                - if (data.length === 0)
                    p.text-danger Error fetching stats data, please try again.
                - else
                    p Total requests per file and total bandwidth of popular files.

                    .table-responsive
                        table#popular-table.table
                            thead.tablesorter-header
                                tr
                                    th.sorter-false &nbsp;
                                    th File
                                        i.tablesorter-icon.pull-right
                                    th.sorter-false Hits (Requests)
                                    th.sorter-digit &nbsp; &nbsp;
                                        i.tablesorter-icon.pull-right
                                    th.sorter-false Bandwidth
                                    th.sorter-digit &nbsp; &nbsp;
                                        i.tablesorter-icon.pull-right
                            tbody
                                - var maxHits = helpers.calculateTotal(data, 'hit');
                                - var maxSize = helpers.calculateTotal(data, 'size');
                                - for entry in data.sort(function(a,b) { return b.hit - a.hit; })
                                    - if (entry.hit > 1000)
                                        tr
                                            td
                                                - var ext = entry.uri.match(/\.[a-zA-Z0-9]+$/)[0].replace(/^\./, '');
                                                img(src="/images/reports/" + ext + ".png", alt=ext, width="30", height="30")
                                            td= entry.uri
                                            td
                                                .progress
                                                    - var hitProgress = ((entry.hit / maxHits) * 100).toFixed(2);
                                                    .progress-bar(
                                                        role="progressbar",
                                                        aria-valuenow=hitProgress,
                                                        aria-valuemin="0",
                                                        aria-valuemax="100",
                                                        style="width: " + hitProgress + "%")
                                                        span.sr-only= hitProgress + "%"
                                            td= numeral(entry.hit).format('0,0') + ' Requests'
                                            td
                                                .progress
                                                    - var sizeProgress = ((entry.size / maxSize) * 100).toFixed(2);
                                                    .progress-bar(
                                                        role="progressbar",
                                                        aria-valuenow=sizeProgress,
                                                        aria-valuemin="0",
                                                        aria-valuemax="100",
                                                        style="width: " + sizeProgress + "%")
                                                        span.sr-only= sizeProgress + " GB"
                                            td= numeral(entry.size).format('0.00 b')

                a(href="http://medialoot.com/") Icons by Medialoot.com

        include _partials/footer

block last
    script(src='/javascripts/jquery.tablesorter.combined.min.js')
    script
        :uglify-js
            $('table#popular-table').ready(function() {
                $('table#popular-table').tablesorter({
                    theme         : 'bootstrap',
                    widgets       : ['uitheme','zebra'],
                    widgetOptions : { 
                        zebra: ['even', 'odd']
                    }
                });
            });

//- vim: ft=jade sw=4 sts=4 et:
